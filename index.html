<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ultra Milk</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; overflow: hidden; font-family: sans-serif; }
    canvas { display: block; }

    #menuOverlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: black;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-direction: row;
      z-index: 10;
    }

    #menuLeft {
      color: white;
      padding: 2rem;
    }
    #menuLeft button {
      display: block;
      margin: 1rem 0;
      padding: 1rem;
      font-size: 1.2rem;
      cursor: pointer;
    }

    #settingsMenu {
      display: none;
      flex-direction: column;
      gap: 1rem;
      margin-top: 1rem;
    }

    #menuRight {
      margin-right: 5rem;
      width: 200px;
      height: 200px;
    }
  </style>
</head>
<body>
  <div id="menuOverlay">
    <div id="menuLeft">
      <button id="startButton">Start</button>
      <button id="settingsButton">Settings</button>
      <div id="settingsMenu">
        <label>Sensitivity: <input type="range" id="sensitivitySlider" min="0.1" max="2" step="0.1" value="1"></label>
      </div>
    </div>
    <div id="menuRight">
      <canvas id="milkmanCanvas"></canvas>
    </div>
  </div>

  <script type="module">
    import * as THREE from 'https://cdn.skypack.dev/three@0.152.2';
    import { OrbitControls } from 'https://cdn.skypack.dev/three@0.152.2/examples/jsm/controls/OrbitControls.js';

    // ===== MENU MILKMAN SPINNING MODEL (WHITE CUBE) =====
    const milkmanCanvas = document.getElementById('milkmanCanvas');
    const menuScene = new THREE.Scene();
    const menuCamera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
    menuCamera.position.z = 3;
    const menuRenderer = new THREE.WebGLRenderer({ canvas: milkmanCanvas, alpha: true });
    menuRenderer.setSize(200, 200);
    const menuGeometry = new THREE.BoxGeometry(1, 2, 1);
    const menuMaterial = new THREE.MeshStandardMaterial({ color: 'white' });
    const milkman = new THREE.Mesh(menuGeometry, menuMaterial);
    menuScene.add(milkman);
    const menuLight = new THREE.DirectionalLight('white', 1);
    menuLight.position.set(2, 2, 2);
    menuScene.add(menuLight);
    function animateMenu() {
      requestAnimationFrame(animateMenu);
      milkman.rotation.y += 0.01;
      menuRenderer.render(menuScene, menuCamera);
    }
    animateMenu();

    // ===== MAIN GAME =====
    const gameScene = new THREE.Scene();
    const gameCamera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    const gameRenderer = new THREE.WebGLRenderer();
    gameRenderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(gameRenderer.domElement);

    const sensitivitySlider = document.getElementById('sensitivitySlider');
    let sensitivity = parseFloat(sensitivitySlider.value);
    sensitivitySlider.addEventListener('input', () => {
      sensitivity = parseFloat(sensitivitySlider.value);
    });

    const controls = {
      forward: false,
      backward: false,
      left: false,
      right: false,
      jumping: false,
    };

    document.addEventListener('keydown', e => {
      if (e.code === 'KeyW') controls.forward = true;
      if (e.code === 'KeyS') controls.backward = true;
      if (e.code === 'KeyA') controls.left = true;
      if (e.code === 'KeyD') controls.right = true;
      if (e.code === 'Space') controls.jumping = true;
    });

    document.addEventListener('keyup', e => {
      if (e.code === 'KeyW') controls.forward = false;
      if (e.code === 'KeyS') controls.backward = false;
      if (e.code === 'KeyA') controls.left = false;
      if (e.code === 'KeyD') controls.right = false;
      if (e.code === 'Space') controls.jumping = false;
    });

    const player = new THREE.Mesh(new THREE.BoxGeometry(1, 2, 1), new THREE.MeshBasicMaterial({color: 'white'}));
    player.position.y = 1;
    gameScene.add(player);
    gameCamera.position.set(0, 2, 5);
    gameCamera.lookAt(player.position);

    const floor = new THREE.GridHelper(100, 100);
    gameScene.add(floor);

    const light = new THREE.HemisphereLight('white', 'gray', 1);
    gameScene.add(light);

    // Mouse movement
    let pitch = 0, yaw = 0;
    let isMouseLocked = false;

    document.addEventListener('mousemove', (event) => {
      if (!isMouseLocked) return;
      yaw -= event.movementX * 0.002 * sensitivity;
      pitch -= event.movementY * 0.002 * sensitivity;
      pitch = Math.max(-Math.PI/2, Math.min(Math.PI/2, pitch));
      gameCamera.rotation.set(pitch, yaw, 0);
    });

    function gameLoop() {
      requestAnimationFrame(gameLoop);
      let dir = new THREE.Vector3();
      if (controls.forward) dir.z -= 1;
      if (controls.backward) dir.z += 1;
      if (controls.left) dir.x -= 1;
      if (controls.right) dir.x += 1;
      dir.applyAxisAngle(new THREE.Vector3(0, 1, 0), yaw);
      dir.normalize();
      player.position.addScaledVector(dir, 0.1);
      gameCamera.position.set(player.position.x, player.position.y + 1.5, player.position.z);
      gameRenderer.render(gameScene, gameCamera);
    }

    gameLoop();

    // === MENU INTERACTION ===
    const overlay = document.getElementById('menuOverlay');
    document.getElementById('startButton').onclick = () => {
      overlay.style.display = 'none';
      gameRenderer.domElement.requestPointerLock();
      isMouseLocked = true;
    };

    document.getElementById('settingsButton').onclick = () => {
      const menu = document.getElementById('settingsMenu');
      menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
    };
  </script>
</body>
</html>
