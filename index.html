<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ultra Milk</title>
  <style>
    html, body {
      margin: 0;
      overflow: hidden;
      background: #000;
    }
    canvas {
      display: block;
    }
    #menu {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 4rem;
      font-family: sans-serif;
    }
    #menu button {
      display: block;
      margin: 1rem 0;
      font-size: 2rem;
      padding: 0.5rem 1rem;
    }
    #settingsMenu {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #111;
      padding: 2rem;
      border: 2px solid white;
      display: none;
      flex-direction: column;
      gap: 1rem;
      font-size: 1.2rem;
    }
    #settingsMenu input {
      width: 100%;
    }
  </style>
</head>
<body>
  <div id="menu">
    <div>
      <button id="startBtn">Start</button>
      <button id="settingsBtn">Settings</button>
    </div>
    <div>
      <div id="milkman" style="width:200px;height:200px;background:white;animation:spin 5s linear infinite;"></div>
    </div>
  </div>
  <div id="settingsMenu">
    <label>Sensitivity: <input id="sensitivity" type="range" min="0.1" max="2" step="0.1" value="0.5"></label>
    <button onclick="closeSettings()">Close</button>
  </div>
  <script type="module">
    import * as THREE from 'https://cdn.skypack.dev/three@0.160.0';
    import { PointerLockControls } from 'https://cdn.skypack.dev/three/examples/jsm/controls/PointerLockControls.js';

    let scene, camera, renderer, controls, velocity = new THREE.Vector3(), direction = new THREE.Vector3();
    let canJump = false, onGround = false, clock = new THREE.Clock(), sensitivity = 0.5;

    const menu = document.getElementById('menu');
    const settingsMenu = document.getElementById('settingsMenu');

    document.getElementById('startBtn').onclick = () => {
      menu.style.display = 'none';
      controls.lock();
    };

    document.getElementById('settingsBtn').onclick = () => {
      settingsMenu.style.display = 'flex';
    };

    window.closeSettings = () => {
      settingsMenu.style.display = 'none';
    };

    document.getElementById('sensitivity').oninput = e => sensitivity = parseFloat(e.target.value);

    init();
    animate();

    function init() {
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x87ceeb);

      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);

      renderer = new THREE.WebGLRenderer();
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      controls = new PointerLockControls(camera, renderer.domElement);
      scene.add(controls.getObject());

      const floor = new THREE.Mesh(new THREE.PlaneGeometry(200, 200, 20, 20), new THREE.MeshBasicMaterial({ color: 0x008800, wireframe: true }));
      floor.rotation.x = -Math.PI / 2;
      scene.add(floor);

      const geometry = new THREE.BoxGeometry(1, 1, 1);
      const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
      const cube = new THREE.Mesh(geometry, material);
      cube.position.y = 0.5;
      scene.add(cube);

      for (let i = 0; i < 5; i++) {
        const wall = new THREE.Mesh(new THREE.BoxGeometry(1, 3, 10), new THREE.MeshBasicMaterial({ color: 0xffffff }));
        wall.position.set(i * 3, 1.5, -10);
        scene.add(wall);
      }

      document.addEventListener('keydown', onKeyDown);
      document.addEventListener('keyup', onKeyUp);
      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });
    }

    const keys = {};

    function onKeyDown(event) {
      keys[event.code] = true;
      if (event.code === 'Space' && canJump) {
        velocity.y += 5;
        canJump = false;
      }
    }

    function onKeyUp(event) {
      keys[event.code] = false;
    }

    function animate() {
      requestAnimationFrame(animate);

      const delta = clock.getDelta();
      velocity.x -= velocity.x * 10.0 * delta;
      velocity.z -= velocity.z * 10.0 * delta;
      velocity.y -= 9.8 * delta; // gravity

      direction.z = Number(keys['KeyW']) - Number(keys['KeyS']);
      direction.x = Number(keys['KeyD']) - Number(keys['KeyA']);
      direction.normalize();

      if (keys['ShiftLeft']) {
        velocity.z -= direction.z * 30.0 * delta;
        velocity.x -= direction.x * 30.0 * delta;
      } else {
        velocity.z -= direction.z * 10.0 * delta;
        velocity.x -= direction.x * 10.0 * delta;
      }

      controls.moveRight(-velocity.x * delta);
      controls.moveForward(-velocity.z * delta);
      controls.getObject().position.y += velocity.y * delta;

      if (controls.getObject().position.y < 1.6) {
        velocity.y = 0;
        controls.getObject().position.y = 1.6;
        canJump = true;
      }

      controls.getObject().rotation.order = "YXZ";
      controls.getObject().rotation.y += (direction.x * sensitivity * delta);

      renderer.render(scene, camera);
    }
  </script>
</body>
</html>